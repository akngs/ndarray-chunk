!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.chunk=e():r.chunk=e()}(this,function(){return function(r){function e(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return r[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=r,e.c=t,e.p="",e(0)}([function(r,e,t){"use strict";function n(r){return r&&r.__esModule?r:{"default":r}}function o(r,e){if(r=r.shape?r:(0,s["default"])(r),r.shape.length!==e.length)throw new Error("Shape mismatch");var t=e.length;if(1===t){for(var n=r.shape[0]%e[0],o=Math.floor(r.shape[0]/e[0])+!!n,a=new Array(o),i=0;o>i;++i)a[i]=r.hi(Math.min(i*e[0]+e[0],r.shape[0])).lo(i*e[0]);return a}if(2===t){for(var u=r.shape[0]%e[0],h=r.shape[1]%e[1],p=Math.floor(r.shape[0]/e[0])+!!u,c=Math.floor(r.shape[1]/e[1])+!!h,a=new Array(p),i=0;p>i;++i){a[i]=new Array(c);for(var f=0;c>f;++f)a[i][f]=r.hi(Math.min(i*e[0]+e[0],r.shape[0]),Math.min(f*e[1]+e[1],r.shape[1])).lo(i*e[0],f*e[1])}return a}throw new Error("Unsupported rank")}Object.defineProperty(e,"__esModule",{value:!0}),e.chunk=void 0;var a=t(1),s=n(a);e.chunk=o},function(r,e,t){"use strict";var n=t(2),o=t(5);r.exports=function(r,e){for(var t=[],a=r,s=1;a instanceof Array;)t.push(a.length),s*=a.length,a=a[0];return 0===t.length?n():(e||(e=n(new Float64Array(s),t)),o(e,r),e)}},function(r,e,t){function n(r,e){return r[0]-e[0]}function o(){var r,e=this.stride,t=new Array(e.length);for(r=0;r<t.length;++r)t[r]=[Math.abs(e[r]),r];t.sort(n);var o=new Array(t.length);for(r=0;r<o.length;++r)o[r]=t[r][1];return o}function a(r,e){var t=["View",e,"d",r].join("");0>e&&(t="View_Nil"+r);var n="generic"===r;if(-1===e){var a="function "+t+"(a){this.data=a;};	var proto="+t+".prototype;	proto.dtype='"+r+"';	proto.index=function(){return -1};	proto.size=0;	proto.dimension=-1;	proto.shape=proto.stride=proto.order=[];	proto.lo=proto.hi=proto.transpose=proto.step=	function(){return new "+t+"(this.data);};	proto.get=proto.set=function(){};	proto.pick=function(){return null};	return function construct_"+t+"(a){return new "+t+"(a);}",s=new Function(a);return s()}if(0===e){var a="function "+t+"(a,d) {	this.data = a;	this.offset = d	};	var proto="+t+".prototype;	proto.dtype='"+r+"';	proto.index=function(){return this.offset};	proto.dimension=0;	proto.size=1;	proto.shape=	proto.stride=	proto.order=[];	proto.lo=	proto.hi=	proto.transpose=	proto.step=function "+t+"_copy() {	return new "+t+"(this.data,this.offset)	};	proto.pick=function "+t+"_pick(){	return TrivialArray(this.data);	};	proto.valueOf=proto.get=function "+t+"_get(){	return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};	proto.set=function "+t+"_set(v){	return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"	};	return function construct_"+t+"(a,b,c,d){return new "+t+"(a,d)}",s=new Function("TrivialArray",a);return s(c[r][0])}var a=["'use strict'"],i=u(e),h=i.map(function(r){return"i"+r}),p="this.offset+"+i.map(function(r){return"this.stride["+r+"]*i"+r}).join("+"),f=i.map(function(r){return"b"+r}).join(","),l=i.map(function(r){return"c"+r}).join(",");a.push("function "+t+"(a,"+f+","+l+",d){this.data=a","this.shape=["+f+"]","this.stride=["+l+"]","this.offset=d|0}","var proto="+t+".prototype","proto.dtype='"+r+"'","proto.dimension="+e),a.push("Object.defineProperty(proto,'size',{get:function "+t+"_size(){	return "+i.map(function(r){return"this.shape["+r+"]"}).join("*"),"}})"),1===e?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),4>e?(a.push("function "+t+"_order(){"),2===e?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);	if(s0>s1){	if(s1>s2){	return [2,1,0];	}else if(s0>s2){	return [1,2,0];	}else{	return [1,0,2];	}	}else if(s0>s2){	return [2,0,1];	}else if(s2>s1){	return [0,1,2];	}else{	return [0,2,1];	}}})")):a.push("ORDER})")),a.push("proto.set=function "+t+"_set("+h.join(",")+",v){"),n?a.push("return this.data.set("+p+",v)}"):a.push("return this.data["+p+"]=v}"),a.push("proto.get=function "+t+"_get("+h.join(",")+"){"),n?a.push("return this.data.get("+p+")}"):a.push("return this.data["+p+"]}"),a.push("proto.index=function "+t+"_index(",h.join(),"){return "+p+"}"),a.push("proto.hi=function "+t+"_hi("+h.join(",")+"){return new "+t+"(this.data,"+i.map(function(r){return["(typeof i",r,"!=='number'||i",r,"<0)?this.shape[",r,"]:i",r,"|0"].join("")}).join(",")+","+i.map(function(r){return"this.stride["+r+"]"}).join(",")+",this.offset)}");var d=i.map(function(r){return"a"+r+"=this.shape["+r+"]"}),g=i.map(function(r){return"c"+r+"=this.stride["+r+"]"});a.push("proto.lo=function "+t+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+g.join(","));for(var y=0;e>y;++y)a.push("if(typeof i"+y+"==='number'&&i"+y+">=0){	d=i"+y+"|0;	b+=c"+y+"*d;	a"+y+"-=d}");a.push("return new "+t+"(this.data,"+i.map(function(r){return"a"+r}).join(",")+","+i.map(function(r){return"c"+r}).join(",")+",b)}"),a.push("proto.step=function "+t+"_step("+h.join(",")+"){var "+i.map(function(r){return"a"+r+"=this.shape["+r+"]"}).join(",")+","+i.map(function(r){return"b"+r+"=this.stride["+r+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var y=0;e>y;++y)a.push("if(typeof i"+y+"==='number'){	d=i"+y+"|0;	if(d<0){	c+=b"+y+"*(a"+y+"-1);	a"+y+"=ceil(-a"+y+"/d)	}else{	a"+y+"=ceil(a"+y+"/d)	}	b"+y+"*=d	}");a.push("return new "+t+"(this.data,"+i.map(function(r){return"a"+r}).join(",")+","+i.map(function(r){return"b"+r}).join(",")+",c)}");for(var v=new Array(e),j=new Array(e),y=0;e>y;++y)v[y]="a[i"+y+"]",j[y]="b[i"+y+"]";a.push("proto.transpose=function "+t+"_transpose("+h+"){"+h.map(function(r,e){return r+"=("+r+"===undefined?"+e+":"+r+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+t+"(this.data,"+v.join(",")+","+j.join(",")+",this.offset)}"),a.push("proto.pick=function "+t+"_pick("+h+"){var a=[],b=[],c=this.offset");for(var y=0;e>y;++y)a.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+t+"(data,shape,stride,offset){return new "+t+"(data,"+i.map(function(r){return"shape["+r+"]"}).join(",")+","+i.map(function(r){return"stride["+r+"]"}).join(",")+",offset)}");var s=new Function("CTOR_LIST","ORDER",a.join("\n"));return s(c[r],o)}function s(r){if(h(r))return"buffer";if(p)switch(Object.prototype.toString.call(r)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(r)?"array":"generic"}function i(r,e,t,n){if(void 0===r){var o=c.array[0];return o([])}"number"==typeof r&&(r=[r]),void 0===e&&(e=[r.length]);var i=e.length;if(void 0===t){t=new Array(i);for(var u=i-1,h=1;u>=0;--u)t[u]=h,h*=e[u]}if(void 0===n){n=0;for(var u=0;i>u;++u)t[u]<0&&(n-=(e[u]-1)*t[u])}for(var p=s(r),f=c[p];f.length<=i+1;)f.push(a(p,f.length-1));var o=f[i+1];return o(r,e,t,n)}var u=t(3),h=t(4),p="undefined"!=typeof Float64Array,c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};r.exports=i},function(r,e){"use strict";function t(r){for(var e=new Array(r),t=0;r>t;++t)e[t]=t;return e}r.exports=t},function(r,e){r.exports=function(r){return!(null==r||!(r._isBuffer||r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)))}},function(r,e,t){r.exports=t(6)({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\nvar _inline_1_v=_inline_1_arg1_,_inline_1_i\nfor(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {\n_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]\n}\n_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]\n}",args:[{name:"_inline_1_arg0_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64})},function(r,e,t){"use strict";function n(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function o(r){var e=new n;e.pre=r.pre,e.body=r.body,e.post=r.post;var t=r.args.slice(0);e.argTypes=t;for(var o=0;o<t.length;++o){var s=t[o];if("array"===s||"object"==typeof s&&s.blockIndices){if(e.argTypes[o]="array",e.arrayArgs.push(o),e.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),e.shimArgs.push("array"+o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===s)e.scalarArgs.push(o),e.shimArgs.push("scalar"+o);else if("index"===s){if(e.indexArgs.push(o),o<e.pre.args.length&&e.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<e.post.args.length&&e.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===s){if(e.shapeArgs.push(o),o<e.pre.args.length&&e.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<e.body.args.length&&e.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<e.post.args.length&&e.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof s||!s.offset)throw new Error("cwise: Unknown argument type "+t[o]);e.argTypes[o]="offset",e.offsetArgs.push({array:s.array,offset:s.offset}),e.offsetArgIndex.push(o)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>t.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>t.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>t.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!r.printCode||!!r.debug,e.funcName=r.funcName||"cwise",e.blockSize=r.blockSize||64,a(e)}var a=t(7);r.exports=o},function(r,e,t){"use strict";function n(r){var e=["'use strict'","var CACHED={}"],t=[],n=r.funcName+"_cwise_thunk";e.push(["return function ",n,"(",r.shimArgs.join(","),"){"].join(""));for(var a=[],s=[],i=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],u=[],h=[],p=0;p<r.arrayArgs.length;++p){var c=r.arrayArgs[p];t.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),a.push("t"+c),a.push("r"+c),s.push("t"+c),s.push("r"+c+".join()"),i.push("array"+c+".data"),i.push("array"+c+".stride"),i.push("array"+c+".offset|0"),p>0&&(u.push("array"+r.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[p]))),h.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[p])+"]"))}r.arrayArgs.length>1&&(e.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),e.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}"));for(var p=0;p<r.scalarArgs.length;++p)i.push("scalar"+r.scalarArgs[p]);t.push(["type=[",s.join(","),"].join()"].join("")),t.push("proc=CACHED[type]"),e.push("var "+t.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",a.join(","),"])}","return proc(",i.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------");var f=new Function("compile",e.join("\n"));return f(o.bind(void 0,r))}var o=t(8);r.exports=n},function(r,e,t){"use strict";function n(r,e,t){var n,o,a=r.length,s=e.arrayArgs.length,i=e.indexArgs.length>0,u=[],h=[],p=0,c=0;for(n=0;a>n;++n)h.push(["i",n,"=0"].join(""));for(o=0;s>o;++o)for(n=0;a>n;++n)c=p,p=r[n],0===n?h.push(["d",o,"s",n,"=t",o,"p",p].join("")):h.push(["d",o,"s",n,"=(t",o,"p",p,"-s",c,"*t",o,"p",c,")"].join(""));for(u.push("var "+h.join(",")),n=a-1;n>=0;--n)p=r[n],u.push(["for(i",n,"=0;i",n,"<s",p,";++i",n,"){"].join(""));for(u.push(t),n=0;a>n;++n){for(c=p,p=r[n],o=0;s>o;++o)u.push(["p",o,"+=d",o,"s",n].join(""));i&&(n>0&&u.push(["index[",c,"]-=s",c].join("")),u.push(["++index[",p,"]"].join(""))),u.push("}")}return u.join("\n")}function o(r,e,t,o){for(var a=e.length,s=t.arrayArgs.length,i=t.blockSize,u=t.indexArgs.length>0,h=[],p=0;s>p;++p)h.push(["var offset",p,"=p",p].join(""));for(var p=r;a>p;++p)h.push(["for(var j"+p+"=SS[",e[p],"]|0;j",p,">0;){"].join("")),h.push(["if(j",p,"<",i,"){"].join("")),h.push(["s",e[p],"=j",p].join("")),h.push(["j",p,"=0"].join("")),h.push(["}else{s",e[p],"=",i].join("")),h.push(["j",p,"-=",i,"}"].join("")),u&&h.push(["index[",e[p],"]=j",p].join(""));for(var p=0;s>p;++p){for(var c=["offset"+p],f=r;a>f;++f)c.push(["j",f,"*t",p,"p",e[f]].join(""));h.push(["p",p,"=(",c.join("+"),")"].join(""))}h.push(n(e,t,o));for(var p=r;a>p;++p)h.push("}");return h.join("\n")}function a(r){for(var e=0,t=r[0].length;t>e;){for(var n=1;n<r.length;++n)if(r[n][e]!==r[0][e])return e;++e}return e}function s(r,e,t){for(var n=r.body,o=[],a=[],s=0;s<r.args.length;++s){var i=r.args[s];if(!(i.count<=0)){var u=new RegExp(i.name,"g"),h="",p=e.arrayArgs.indexOf(s);switch(e.argTypes[s]){case"offset":var c=e.offsetArgIndex.indexOf(s),f=e.offsetArgs[c];p=f.array,h="+q"+c;case"array":h="p"+p+h;var l="l"+s,d="a"+p;if(0===e.arrayBlockIndices[p])1===i.count?"generic"===t[p]?i.lvalue?(o.push(["var ",l,"=",d,".get(",h,")"].join("")),n=n.replace(u,l),a.push([d,".set(",h,",",l,")"].join(""))):n=n.replace(u,[d,".get(",h,")"].join("")):n=n.replace(u,[d,"[",h,"]"].join("")):"generic"===t[p]?(o.push(["var ",l,"=",d,".get(",h,")"].join("")),n=n.replace(u,l),i.lvalue&&a.push([d,".set(",h,",",l,")"].join(""))):(o.push(["var ",l,"=",d,"[",h,"]"].join("")),n=n.replace(u,l),i.lvalue&&a.push([d,"[",h,"]=",l].join("")));else{for(var g=[i.name],y=[h],v=0;v<Math.abs(e.arrayBlockIndices[p]);v++)g.push("\\s*\\[([^\\]]+)\\]"),y.push("$"+(v+1)+"*t"+p+"b"+v);if(u=new RegExp(g.join(""),"g"),h=y.join("+"),"generic"===t[p])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(u,[d,"[",h,"]"].join(""))}break;case"scalar":n=n.replace(u,"Y"+e.scalarArgs.indexOf(s));break;case"index":n=n.replace(u,"index");break;case"shape":n=n.replace(u,"shape")}}}return[o.join("\n"),n,a.join("\n")].join("\n").trim()}function i(r){for(var e=new Array(r.length),t=!0,n=0;n<r.length;++n){var o=r[n],a=o.match(/\d+/);a=a?a[0]:"",0===o.charAt(0)?e[n]="u"+o.charAt(1)+a:e[n]=o.charAt(0)+a,n>0&&(t=t&&e[n]===e[n-1])}return t?e[0]:e.join("")}function u(r,e){for(var t=e[1].length-Math.abs(r.arrayBlockIndices[0])|0,u=new Array(r.arrayArgs.length),p=new Array(r.arrayArgs.length),c=0;c<r.arrayArgs.length;++c)p[c]=e[2*c],u[c]=e[2*c+1];for(var f=[],l=[],d=[],g=[],y=[],c=0;c<r.arrayArgs.length;++c){r.arrayBlockIndices[c]<0?(d.push(0),g.push(t),f.push(t),l.push(t+r.arrayBlockIndices[c])):(d.push(r.arrayBlockIndices[c]),g.push(r.arrayBlockIndices[c]+t),f.push(0),l.push(r.arrayBlockIndices[c]));for(var v=[],j=0;j<u[c].length;j++)d[c]<=u[c][j]&&u[c][j]<g[c]&&v.push(u[c][j]-d[c]);y.push(v)}for(var b=["SS"],_=["'use strict'"],w=[],j=0;t>j;++j)w.push(["s",j,"=SS[",j,"]"].join(""));for(var c=0;c<r.arrayArgs.length;++c){b.push("a"+c),b.push("t"+c),b.push("p"+c);for(var j=0;t>j;++j)w.push(["t",c,"p",j,"=t",c,"[",d[c]+j,"]"].join(""));for(var j=0;j<Math.abs(r.arrayBlockIndices[c]);++j)w.push(["t",c,"b",j,"=t",c,"[",f[c]+j,"]"].join(""))}for(var c=0;c<r.scalarArgs.length;++c)b.push("Y"+c);if(r.shapeArgs.length>0&&w.push("shape=SS.slice(0)"),r.indexArgs.length>0){for(var m=new Array(t),c=0;t>c;++c)m[c]="0";w.push(["index=[",m.join(","),"]"].join(""))}for(var c=0;c<r.offsetArgs.length;++c){for(var A=r.offsetArgs[c],k=[],j=0;j<A.offset.length;++j)0!==A.offset[j]&&(1===A.offset[j]?k.push(["t",A.array,"p",j].join("")):k.push([A.offset[j],"*t",A.array,"p",j].join("")));0===k.length?w.push("q"+c+"=0"):w.push(["q",c,"=",k.join("+")].join(""))}var x=h([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));w=w.concat(x),_.push("var "+w.join(","));for(var c=0;c<r.arrayArgs.length;++c)_.push("p"+c+"|=0");r.pre.body.length>3&&_.push(s(r.pre,r,p));var I=s(r.body,r,p),E=a(y);t>E?_.push(o(E,y[0],r,I)):_.push(n(y[0],r,I)),r.post.body.length>3&&_.push(s(r.post,r,p)),r.debug&&console.log("-----Generated cwise routine for ",e,":\n"+_.join("\n")+"\n----------");var M=[r.funcName||"unnamed","_cwise_loop_",u[0].join("s"),"m",E,i(p)].join(""),B=new Function(["function ",M,"(",b.join(","),"){",_.join("\n"),"} return ",M].join(""));return B()}var h=t(9);r.exports=u},function(r,e){"use strict";function t(r,e){for(var t=1,n=r.length,o=r[0],a=r[0],s=1;n>s;++s)if(a=o,o=r[s],e(o,a)){if(s===t){t++;continue}r[t++]=o}return r.length=t,r}function n(r){for(var e=1,t=r.length,n=r[0],o=r[0],a=1;t>a;++a,o=n)if(o=n,n=r[a],n!==o){if(a===e){e++;continue}r[e++]=n}return r.length=e,r}function o(r,e,o){return 0===r.length?r:e?(o||r.sort(e),t(r,e)):(o||r.sort(),n(r))}r.exports=o}])});
//# sourceMappingURL=ndarray-chunk.min.js.map
